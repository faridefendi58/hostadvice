jQuery(function($){if($('#company-disabled-popup').length>0){Template.popup("#company-disabled-popup");}
$(document).on('click','.comment-reply-link',function(e){e.preventDefault();var $articleForComment=$(this).closest(".article-for-comment");var vars={};vars.review_id=$(this).closest('.user_review_holder').find("[name=review_id]").val()-0;vars.reply_id=$articleForComment.length>0?+$articleForComment.find("[name=reply_id]").val():0;vars.name=$articleForComment.length>0?$articleForComment.find(".reply-author").text().trim():'';if(!vars.name||vars.name.length<1){vars.name=$(this).closest('.user_review_holder').find(".review-author [itemprop=author]").text().trim();}
if(vars.review_id>0){Template.popup("#user-review-reply-form",vars,{'className':'no-padding review-reply-popup'});}});$(document).on('click','form.add_reply .add-reply-btn',function(e){e.preventDefault();var $form=$(this).closest('form');var $response=$form.find('.server-response');Page.startLoad('reply-form','popup');jQuery.post(ajaxUrl_ht,$form.serializeArray(),function(response){Page.finishLoad('reply-form');$response.html('');if(!response.success){Form.putErrors('form.add_reply',response.errors);if(response['global_error'].length){$response.append('<p class="bg-danger">'+response['global_error']+'</p>');}}else{$form.get(0).reset();$response.append('<p class="bg-success">'+response.msg+'</p>');}
$('#colorbox').colorbox.resize();},'json');});$(document).on('click','.comment-helpful-link:not(.loading), .comment-report-link:not(.loading)',function(e){var $this=$(this);var panel=$this;var review_id=$this.closest('.user_review_holder').find('[name="review_id"]').val();panel.addClass('loading');jQuery.post(ajaxUrl_ht,{action:'UserReview_vote',type:$this.is('.comment-helpful-link')?'helpful':'report',review_id:review_id,remove:$this.hasClass('clicked')},function(response){panel.removeClass('loading');if(response.success){if(response.status){$this.addClass('clicked');$this.find('.counter').toggleClass("null",!(response.status.helpful>0)).find('.count').text(response.status.helpful-0);}
$this.toggleClass('clicked',response.status.type==='helpful');}},'json');});$(document).on('click','.review-share-link',function(e){e.preventDefault();var href=$(this).attr('href');Template.popup('#review-share-popup',[],[]);$("#cboxLoadedContent").find(".sharrre[data-url]").attr('data-url',href);initSharrreButtons("#cboxLoadedContent .sharrre");});$(document).on('click','.user_review_holder .screenshot .hover',function(e){e.preventDefault();var img=$(this).closest('.screenshot').find('a.image');var rel=img.attr('rel');$('.screenshot a.image[rel='+rel+']').colorbox({photo:true,className:function(){var title=$(this).attr('title');return 'screenshot-enlarge sideless '+(!title?'titleless':'');},maxWidth:'100%',maxHeight:'100%',title:function(){var screenshot=$(this).closest('.screenshot');var index=screenshot.index()+1;var title=tr("{{n}} Screenshot Explanation").replace("{{n}}",index)+"<br/>"+$(this).attr('title');return title;},onComplete:function(){var photoHeight=$('.cboxPhoto').height(),titleHeight=$('#cboxTitle').height();if((photoHeight-titleHeight)<300){$('#cboxTitle').css({'bottom':'-'+titleHeight+'px'});}else{$('#cboxTitle').css({'bottom':0});}}});$(this).closest('.screenshot').find('a.image').trigger('click');});$(document).on('click','.comment-change-link',function(e){e.preventDefault();var vars={"review_id":$(this).closest('.user_review_holder').find("[name=review_id]").val()-0};if(vars.review_id>0){Template.popup("#review_change_request_popup",vars);}});$(document).on('click','.rcrp-email-submit',function(e){e.preventDefault();var cBox=$(this).closest('#colorbox'),reviewId=cBox.find('#rcrp_review_id').val(),email=cBox.find('#rcrp_user_email').val();$('.crp-message').remove();Page.startLoad('change-review-popup','popup');$.post(ajaxUrl_ht,{"action":'review_change_request',"review_id":reviewId,"email":email},function(res){var textClass=res.success?'success':'error';cBox.find('#rcrp_user_email').before('<label class="crp-message '+textClass+'">'+res.text+'</label>');Page.finishLoad('change-review-popup');if(res.success){setTimeout(function(){$.colorbox.close();},1000);}else{$('#colorbox').colorbox.resize();}},'json');});if(window.location.hash.length&&window.location.hash.indexOf('#change-')===0){var pathArr=window.location.pathname.split('/'),reviewId=typeof pathArr[3]!=='undefined'?pathArr[3]:0,secret=window.location.hash.replace('#change-','');if(reviewId&&secret.length){$.post(ajaxUrl_ht,{"action":'review_change_popup',"review_id":reviewId,"secret":secret},function(res){if(res&&res!='0'){$.colorbox({'width':'60%','html':res,'maxWidth':'98%','fixed':true,onComplete:function(){ReviewForm.initChangeForm();}});}},'html');}}});