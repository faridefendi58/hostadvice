var $=jQuery;var couponsCurrentPage=1;function promptEmail(container){var coupon=$(container),vars={'coupon_title':coupon.find("[name=coupon_title]").val(),'coupon_description':coupon.find("[name=coupon_description]").val(),'coupon_hosting':coupon.find("[name=coupon_hosting]").val(),'coupon_code':coupon.find("[name=coupon_code]").val(),'coupon_link':coupon.find("[name=coupon_link]").val(),'coupon_id':coupon.find("[name=coupon_id]").val(),'coupon_hosting_link':coupon.find("[name=coupon_hosting_link]").val()};Template.popup('#coupon-email-popup',vars);}
function initCouponsSearch(){if(!$('.coupons-search').length){return;}
if(Device.isScreen()){$('.coupons-search').stick_in_parent();}
$("#coupons_search").autocomplete({minLength:0,source:function(request,response){var data={},href='https://'+window.location.hostname+window.location.pathname,url=href;if(typeof request.term!=='undefined'&&request.term.length){data['search']=request.term;href+='?search='+request.term;}
$.get(url,data,function(html){$('#hot-coupons').find('.loadable-content').replaceWith($(html).find("#hot-coupons").find('.loadable-content'));Page.scrollTo("#hot-coupons");if(Modernizr.history){window.history.pushState(null,$('title').html(),href);}
couponsCurrentPage=1;initCouponsSearch();},'html');}});}
jQuery(function($){initCouponsSearch();var $coupon_list=$('.coupon-list');if($coupon_list.find('.coupon-popup-wrap').length>0){Template.popup('.coupon-popup-wrap',{},{'className':'no-padding'});}
$(document).on('click',".coupon-prompt-popup button",function(e){var $form=$(this).closest('form');var validator=Form.validate($form);if(!validator.checkForm()){return;}
Page.startLoad('coupon-email','popup');$.ajax({url:ajaxUrl_ht,type:'post',data:$form.serialize()+"&action=coupon_email",dataType:'json',success:function(response){if(response.success===true){Page.closePopups();}else if(response.errors){Form.putErrors($form,response.errors);}},error:function(){},complete:function(){Page.finishLoad('coupon-email','#colorbox');}});e.preventDefault();});$(document).on('click','.coupon .show-coupon',function(){var coupon=$(this).closest('.coupon'),coupon_link=coupon.find("[name=coupon_link]").val();Page.inNewTab($(this).data("link"));Page.load(coupon_link);});Page.onHashTag("hosting-coupons-guide",function(){Page.scrollTo("#hosting-coupons-guide",600,-50);$.colorbox.close();});$(document).on('click','.coupon-vote',function(e){var voter=$(this);var coupon_id=voter.data('coupon-id');var tag='coupon-vote-'+coupon_id;if(Page.tagIsFree(tag)){var holder=voter.closest('.coupon');var step;if(holder.length>0){Page.startLoad(tag,holder.find('.action-loader'));step=holder;}else{Page.startLoad(tag,$('#colorbox').find('.action-loader'));step=voter.closest('.step');}
$.ajax({url:ajaxUrl_ht,type:'post',data:{action:'coupon_vote',coupon_id:coupon_id,vote:!voter.is('.voted')?voter.data('vote'):'cancel'},dataType:'json',success:function(response){if(response.success===true){$([step.get(0),$('#hosting-coupons').find('.coupon[data-coupon-id='+coupon_id+']').get(0)]).each(function(){var step=$(this);step.find('.thanks').addClass('active');step.find('.coupon-vote.voted').removeClass('voted');step.find('.coupon-vote[data-vote="'+response.vote+'"]').addClass('voted');step.find('.vote-count').text(response.votes);step.find('.vote-successful').text(response.successful);});}},complete:function(){Page.finishLoad('coupon-vote-'+coupon_id);}});}
e.preventDefault();});$('.coupon-list').on('click','.coupon-email-button',function(e){promptEmail($(this).closest('.coupon'));});function updateUsedTime(coupon_ids){$.ajax({url:ajaxUrl_ht,dataType:"json",type:"post",cache:false,data:{action:'update-coupon-used-time',coupon_ids:coupon_ids,url:window.location.href},success:function(data){console.log(data);}});}
var colorbox=$('#colorbox');var copierInitialized=false;function initCopier(){if(!copierInitialized&&$('#colorbox .code-copier').length>0){copierInitialized=true;new Clipboard('#colorbox .code-copier',{text:function(trigger){var text=$(trigger).closest('.code-copier').find('.code').text();return text;}}).on('success',function(e){updateUsedTime([$(e.trigger).closest('.coupon-popup').find('.coupon_id').val()]);var button=$(e.trigger).find('.copy');button.closest('.code-copier').addClass("copied");button.find('span').text(button.data('copied-text'));e.clearSelection();}).on('error',function(e){console.log(e);});}}
if($('#colorbox .code-copier').length>0){initCopier();}else{$.colorbox.settings.onComplete=function(){initCopier();};}
colorbox.find('.subscribe-coupons').each(function(){$(this).click(function(e){e.preventDefault();var form=$(this).closest("form");Page.startLoad('subscribe-coupons',$(this).closest(".subscribe-block"));$.ajax({url:ajaxUrl_ht,type:'post',data:form.serialize()+"&action=coupons_subscribe",dataType:'json',success:function(response){Form.putErrors(form,response.errors);if(response.success===true){form.find('[name="email"]').val('');}else if(response.errors){}},error:function(){},complete:function(){Page.finishLoad('subscribe-coupons');}});});});$(document).on('pre-show-popup-close',function(){if(window.history&&window.history.pushState){var backURL=document.location.pathname.replace(/-coupons\/(\d+\/)/,"-coupons/");window.history.replaceState({},undefined,backURL);}});$('.show-expired-coupons').on('click',function(){var expiredList=$(".coupon-list.expired");if(expiredList.is(":visible")){Page.scrollTo(".coupon-list:not(.expired)",0,-20);}else{Page.scrollTo(expiredList,0,-20);}
expiredList.toggle();var text=$(this).text();$(this).text($(this).data("toggle-text"));$(this).data("toggle-text",text);});$('#hot-coupons').on('click','.show-more-hot-coupons',function(){var btn=$(this),data={'_page':++couponsCurrentPage};Page.startLoad('more_coupons','.loadable-content');$.get(window.location.href,data,function(html){btn.remove();Page.finishLoad('more_coupons');$('#hot-coupons').find('.loadable-content').append($(html).find("#hot-coupons").find('.loadable-content').html());initCouponsSearch();},'html');});});