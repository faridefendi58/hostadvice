jQuery(function($){var isPPC=$('#hosting-companies-template').hasClass('is-ppc');var loadingComplete=false,loading=false,table=$('#hosting-companies-table tbody');var form=$('.hosting-filtering-form');var filters=form.serializeArray();var $holder=$('#hosting-companies-holder');var banner_1='';var banner_2='';$.ajax({url:ajaxUrl_ht,type:'GET',data:{action:'get_wide_banner'},success:function(response){if(!response)return;var image_url=$(response).find('img').attr('src');var image=new Image();$(image).one('load error',function(){$('#hosting_services_top_part_banner').html(response);banner_1=response;});image.src=image_url;}});$.ajax({url:ajaxUrl_ht,type:'GET',data:{action:'get_wide_banner'},success:function(response){if(!response)return;var image_url=$(response).find('img').attr('src');var image=new Image();$(image).one('load error',function(){$('#hosting_services_bottom_part_banner').html(response);banner_2=response;});image.src=image_url;}});var $cont=$('#container');var $side=$('#secondary');if($side.length>0){var $stick=$('.ppc-categories').length>0?$side.find('.ppc-categories'):$side.find('.sticky-content');var diff=$side.outerHeight()-$stick.outerHeight(true);$('#secondary .toggle-show-more, #secondary .toggle-show-less').on('click',function(e){e.preventDefault();setTimeout(function(){diff=$side.outerHeight()-$stick.outerHeight(true);},100);});var oldTop=0;$(window).scroll(function(e){var $stickyFilters=$('.sticky-filters');if($stickyFilters.length>0){var bottomOfSidebar=$('#secondary').get(0).getBoundingClientRect().bottom;if(bottomOfSidebar<-10){if(!$stickyFilters.hasClass('fixed-on-top')){$('.quick-filters-padding').height($stickyFilters.outerHeight());$stickyFilters.addClass('fixed-on-top');}}else{$('.quick-filters-padding').height(0);$stickyFilters.removeClass('fixed-on-top');}}else{$stick=$('.ppc-categories').length>0?$('#secondary .ppc-categories'):$('#secondary .sticky-content');if((isPPC&&!Device.isBigScreen())||(!isPPC&&Device.isTablet())){$stick.css({'position':'static'});return false;}
var contentTop=$cont.get(0).getBoundingClientRect().top;var top=(Math.abs(contentTop)-diff);var stickHeight=$stick.outerHeight();var deltaTop=top-oldTop;oldTop=top;var position='static';var sticky_top=0;var sticky_bottom='inherit';var sideBarTaller=Math.abs($side.outerHeight(true)-$cont.outerHeight(true))<10;if(!sideBarTaller&&top>=0&&contentTop<0){position='fixed';var to=Math.min(0,($(window).outerHeight()-stickHeight));sticky_top=$stick.css('top').replace('auto','0').replace('px','')-deltaTop;sticky_top=Math.min(0,Math.max(sticky_top,to));if(($cont.outerHeight()-Math.abs(contentTop))<stickHeight){position='absolute';sticky_bottom=0;sticky_top='inherit';}}
$stick.css({'position':position,'top':sticky_top,'bottom':sticky_bottom,'width':$stick.parent().width()});}}).scroll();$(window).on("resize",function(){if(!$('.sticky-filters').length){$stick.css({'width':$stick.parent().width()});}});}
function update_hosting_companies_table(scroll){var data=jQuery.extend([],filters);data.push({"name":"sort","value":form.find('[name="sort"]').val()});data.push({"name":"order","value":form.find('[name="order"]').val()});data.push({"name":"action","value":"hp_getHostingCompanies"});if(scroll){data.push({"name":"offset","value":scroll?table.find('tr').length:0});}else{loadingComplete=false;}
table.css('opacity','0.5');$.post(ajaxUrl_ht+'?'+Math.random(),data,function(html){loading=false;table.css('opacity','1');if($(html).is(':contains("No companies")')){loadingComplete=true;if(scroll){return;}}
if(scroll){table.append($(html).find('tbody').html());}else{table.html($(html).find('tbody').html());}},'html');}
table.closest('table').find('.sortable-col').click(function(event){event.stopPropagation=true;event.preventDefault=true;var $td=$(this);var sort='';var order='asc';$td.closest('table').find('.sortable-col').not($td).removeClass('sorted').removeClass('inverse');$('.sorted-by-container').text(tr("Sorted by "+$td.find('.sorted-by-hidden').text()));if($td.hasClass('sorted')&&!$td.hasClass('inverse')){$td.addClass('inverse');order='desc';}else{$td.removeClass('inverse');}
$td.addClass('sorted');sort=$td.data('column');form.find('[name="sort"]').val(sort);form.find('[name="order"]').val(order);update_hosting_companies_table();return false;});$('.hosting-filtering-form').animate({'opacity':1},300);$(document).on('click','.hosting-filter-name',function(e){e.preventDefault();e.stopPropagation();var $values=$(this).parent().find('.hosting-filter-values');if($values.is(':hidden')){$values.slideDown(250).addClass('opened');}else{$values.slideUp(250).removeClass('opened');}});$(document).on('click','.hosting-filter-values a, .hosting-filter .dropdown-menu a, .hosting-filter-btn',function(e){e.preventDefault();e.stopPropagation();var templateType=$('#hosting-companies-template').data('template-type');if(templateType!==undefined&&templateType==='loadmore'){var value=$(this).attr('href').substr(1),title=$(this).text();$(this).closest('[data-filter]').data('filter-value',value).find('.hosting-filter-value').text(title);$(this).closest('[data-filter]').find('.hosting-filter-name').click();hostingCompaniesPage=1;loadMoreCompanies();}else{var value=$(this).data('value'),href=$(this).attr('href');if(Modernizr.history){window.history.pushState(null,$('title').html(),href);}
if($(this).closest('.btn-group').length>0){Page.startLoad('ctrl-hosting-companies-load',$(this).closest('.btn-group').find('.btn'));}else if($(this).closest('#secondary').length>0){Page.startLoad('ctrl-hosting-companies-load',$(this).closest('.hosting-filter'));}else if($(this).hasClass('hosting-filter-btn')){Page.startLoad('ctrl-hosting-companies-load',$(this));}
loadCompanies(href);}});$(document).on('click','.load-latest-reviews',function(e){e.preventDefault();var $this=$(this);var hostingId=$this.data('hosting-id');var $row=$('#user-reviews-holder-'+hostingId);var $container=$row.find('.user-reviews-block');if($row.hasClass('active')){$container.css('height',0);$container.html('');$row.removeClass('active');$this.removeClass('active');return;}else{$('.user-reviews-holder.active').each(function(){if($(this).parent().data('hosting-id')!==hostingId){$(this).removeClass('active');$(this).find('.user-reviews-block').html('');$(this).find('.user-reviews-block').css('height',0);}});}
Page.startLoad('load-reviews-'+hostingId,$this);$.post(ajaxUrl_ht,{'action':'load-latest-reviews','hosting-id':hostingId},function(html){$container.html(html);$container.find("article:first").addClass('active');$this.addClass('active');$row.addClass('active');Lazyload.init();adjustLatestReviewsSlider();Page.finishLoad('load-reviews-'+hostingId);},'html')});$(document).on('click','.ctrl-prev, .ctrl-next',function(e){e.preventDefault();var $slider=$(this).parent().find('.user-reviews-block');var index=$slider.data('index')||0;var totalSlides=$slider.find('article').length;if($(this).hasClass('ctrl-prev')){index--;}else{index++;}
if(index<0){index=totalSlides-1;}else if(index>=totalSlides){index=0;}
$slider.data('index',index);$slider.find('article.active').removeClass('active');$slider.find('article:eq('+index+')').addClass('active');adjustLatestReviewsSlider();});$(document).on('click','.toggle-show-more, .toggle-show-less',function(e){adjustLatestReviewsSlider();});$(document).on('click','.user-reviews-slider-filter a',function(e){e.preventDefault();var hostingId=$(this).closest('tr').data('hosting-id');var $row=$('#user-reviews-holder-'+hostingId);var $container=$row.find('.user-reviews-block');var sort=$(this).attr('href').substr(1);$row.find('.user-reviews-slider-filter a.active').removeClass('active');$(this).addClass('active');Page.startLoad('load-reviews-'+hostingId,$container);$.post(ajaxUrl_ht,{'action':'load-latest-reviews','hosting-id':hostingId,'sort':sort},function(html){$container.html(html);$container.find("article:first").addClass('active');Lazyload.init();adjustLatestReviewsSlider();Page.finishLoad('load-reviews-'+hostingId);},'html')});$(document).on('click','.score-circle',function(){$(this).closest('tr').next().find('.load-latest-reviews:not(".active")').click();});function adjustLatestReviewsSlider(){$('.user-reviews-holder.active article.active').each(function(){var h=$(this).outerHeight(true)+62;$(this).parent().css('height',h);});}
var hostingCompaniesPage=1;var isLoadingCompanies=false;function loadMoreCompanies(){isLoadingCompanies=true;var data={'action':'load-hosting-companies'};data['_page']=hostingCompaniesPage;data['_ajax']=true;$('[data-filter]').each(function(){if($(this).data('filter-value')!=null&&$(this).data('filter-value')!=null){if(typeof data['filter']=='undefined')data['filter']={};data['filter'][$(this).data('filter')]=$(this).data('filter-value');}});if($('#infinite-loader').length===0){Page.startLoad('hosting-companies-load',$holder);}
$.get(location.href,data,function(html){var companiesHTML=$(html).html();if(hostingCompaniesPage<=1){$holder.html(companiesHTML);$('body').hide().show(0);}else{var $companiesHTML=$('<div>'+companiesHTML+'</div>');$companiesHTML.find('.actions-bar').remove();$('#load-more-companies, #infinite-loader').remove();$holder.append($companiesHTML);}
if(hostingCompaniesPage<=1){Page.scrollTo('#hosting-companies-holder',400);}
$('#hosting_services_top_part_banner').html(banner_1);$('#hosting_services_bottom_part_banner').html(banner_2);Page.finishLoad('hosting-companies-load');setTimeout(function(){$(window).trigger('scroll')},1);setTimeout(function(){isLoadingCompanies=false;},250);},'html');}
function loadCompanies(link){isLoadingCompanies=true;$.get(link,{},function(html){var pageTitle=$(html).filter('title').html();html=$(html).find('#hosting-companies-template').html();$('#hosting-companies-template').html(html);$('#hosting_services_top_part_banner').html(banner_1);$('#hosting_services_bottom_part_banner').html(banner_2);$('title').html(pageTitle);updateVisits();if($('.quick-filters').length>0){Page.scrollTo('.quick-filters',400);}else{Page.scrollTo('#hosting-companies-holder',400);}
Page.finishLoad('ctrl-hosting-companies-load');companiesSearchInit();countriesSearchInit();PriceFilter.init();Lazyload.init();setTimeout(function(){$(window).trigger('scroll')},1);setTimeout(function(){isLoadingCompanies=false;},250);if(typeof window.CheckedComparisonPopup!=='undefined'){CheckedComparisonPopup.refreshCheckboxes(true);}
latestReviewsInit();var canonicalCategoryUrl=$('#canonical_category_url').val();if(typeof canonicalCategoryUrl!=='undefined'&&canonicalCategoryUrl.length&&canonicalCategoryUrl!==link&&Modernizr.history){window.history.pushState(null,$('title').html(),canonicalCategoryUrl);}
if(link.indexOf('server')!==-1){$('.hosting-filter-server_location').addClass('selected');$(document).on('click','#clean_country_filter',function(){$('.hosting-filter-server_location').removeClass('selected');;loadCompanies(currentPageLink);window.history.pushState(null,$('title').html(),currentPageLink);});}},'html');}
$('#hosting-companies-template').on('click','#load-more-companies',function(e){e.preventDefault();$holder.find('.ajax-loader:not(:last)').remove();hostingCompaniesPage++;loadMoreCompanies();});$('body').on('#show-all-companies','click',function(e){e.preventDefault();$('.hosting-company-holder.hidden').removeClass('hidden');$(this).remove();});$(document).on('click','#companies-pagination #companies-next-page, #companies-pagination a.page-numbers',function(e){e.preventDefault();var href=$(this).attr('href');if(Modernizr.history){window.history.pushState(null,$('title').html(),href);}
Page.startLoad('ctrl-hosting-companies-load',$(this));loadCompanies(href);});window.onpopstate=function(event){if(typeof event.target!=='undefined'&&typeof event.target.location!=='undefined'&&event.target.location.pathname.indexOf('/hosting-companies')==0){loadCompanies(event.target.location.href);}};$(document).on('change','.stars_holder input',function(){var $reviewsCount=$(this).closest('.hosting-company-holder').find('.reviews-count');var $reviewsScore=$(this).closest('.hosting-company-holder').find('.score-circle div');if(!$reviewsCount.hasClass('already-voted')){$(this).data('initial-reviews-count',$reviewsCount.text());$(this).data('initial-reviews-score',$reviewsScore.text());$reviewsCount.text(1+ +$reviewsCount.text());}
var user_score=+$(this).val();var reviews=+$(this).data('initial-reviews-count');var score=+$(this).data('initial-reviews-score');var new_score=Math.round(((reviews*score+user_score)/(reviews+1))*10)/10;$reviewsScore.text(new_score);$reviewsCount.addClass('already-voted');});$(document).on('click','.editor-take-more',function(e){e.preventDefault();var $p=$(this).closest('p');if($(this).hasClass('less')){$p.css({'max-height':'135px','padding-bottom':'0px'});$(this).find('span').html(tr('Read More')+' <i class="fa fa-chevron-down"></i>');$(this).removeClass('less');}else{$p.css({'max-height':'1000px','padding-bottom':'40px'});$(this).find('span').html(tr('Show Less')+' <i class="fa fa-chevron-up"></i>');$(this).addClass('less');}});$(document).on('click','.hosting-coupon-ctrl',function(e){e.preventDefault();Template.popup($(this).attr('href'));});function countriesSearchInit(){var currValue='',currType='';if(!$('#filter-servers-country').length){return false;}
$('#filter-servers-country').focus(function(){currValue=$(this).val();$(this).val('');}).blur(function(){$(this).val(currValue);}).keyup(function(event){if(event.keyCode==13&&$(this).val()===''){loadCompanies(serverLocationEmptyLink);if(Modernizr.history){window.history.pushState(null,$('title').html(),serverLocationEmptyLink);}}});$('#filter-servers-country').autocomplete({source:function(request,response){request['action']='servers_location_filter';request['clean_filters']=typeof cleanFilters!=='undefined'?cleanFilters:[];request['current_page']=typeof currentPageLink!=='undefined'?currentPageLink:window.location.pathname.replace(/filters--(.+)/,'');jQuery.post(typeof ajaxurl!=='undefined'?ajaxurl:ajaxUrl_ht,request,function(data){currType='';response(data);},'json');},focus:function(event,ui){$('#filter-servers-country').val(ui.item.title);return false;},select:function(event,ui){$('#filter-servers-country').val(ui.item.title);if(typeof ui.item.link!=='undefined'){if(Modernizr.history){window.history.pushState(null,$('title').html(),ui.item.link);}
loadCompanies(ui.item.link);}
return false;},}).data("ui-autocomplete")._renderItem=function(ul,item){ul.addClass('sidebar slf-autocomplete');if(currType!=item.type){if(currType.length){currType=item.type;ul.find('li').last().addClass('no-border');$("<li></li>").appendTo(ul);}else{currType=item.type;}}
return $("<li></li>").append("<a href=\"javascript:void(0);\">"+item.label+"</a>").data("ui-autocomplete-item",item).appendTo(ul);}}
var PriceFilter={sliderEl:null,fromPrice:null,toPrice:null,maxPrice:null,filterLink:null,disabled:true,maxStepsCount:25,stepsCount:0,values:[],getValueByStep:function(sliderValue){var self=this;return typeof self.values[sliderValue]!=='undefined'?self.values[sliderValue]:0;},getStepByValue:function(value){var self=this;for(var i=0;i<self.values.length;i++){if(self.values[i]>=value){return i;}}
return 0;},setValues:function(){var self=this;for(var step=0;step<=self.maxStepsCount;step++){var stepValue=self.getStepValue(step);if(stepValue>self.maxPrice){if(self.values[self.values.length-1]<self.maxPrice){self.values.push(Math.round(self.maxPrice))}
return false;}else{self.values.push(stepValue);}}},getStepValue:function(step){var self=this;if(step<=10){return step;}
if(step<=13){return Math.round(((step-8)*5));}
if(step<=16){return Math.round(((step-12)*25));}
if(step<=17){return Math.round(((step-15)*100));}
if(step<=19){return Math.round(((step-16)*500));}
return Math.round(self.maxPrice/((self.maxStepsCount+1)-step));},initSlider:function(){var self=this;var slider=self.sliderEl.slider({range:true,disabled:self.disabled,step:1,min:0,max:self.stepsCount,values:[self.getStepByValue(self.fromPrice),self.getStepByValue(self.toPrice)],slide:function(event,ui){if(ui['values'][0]==0&&ui['values'][1]==self.stepsCount){$('.hosting-filter-price .hosting-filter-value').html(tr('Any'));}else{$('.hosting-filter-price .hosting-filter-value').html('$'+self.getValueByStep(ui['values'][0])+' - $'+self.getValueByStep(ui['values'][1]));}},stop:function(event,ui){if(ui['values'][0]==0&&ui['values'][1]==self.stepsCount){var link=self.filterLink.attr('data-clean-href');}else{var link=self.filterLink.attr('data-href').replace('{from_price}-{to_price}',self.getValueByStep(ui['values'][0])+'-'+self.getValueByStep(ui['values'][1]));}
self.filterLink.attr('href',link);self.filterLink.trigger('click');}});},init:function(){var self=this;self.sliderEl=$("#price-range-filter");self.maxPrice=Math.round(self.sliderEl.attr('data-max-price'));self.fromPrice=parseInt(self.sliderEl.attr('data-from-price'));self.toPrice=parseInt(self.sliderEl.attr('data-to-price'));if(self.toPrice>self.maxPrice){self.toPrice=self.maxPrice;}
self.filterLink=self.sliderEl.parent('.price-slider-holder').find('#price-filter-link');self.disabled=typeof self.maxPrice==='undefined'||isNaN(self.maxPrice);self.values=[];self.setValues();self.stepsCount=self.values.length?(self.values.length-1):0;self.initSlider();}};function updateVisits(){$('[data-visits-tooltip]').each(function(){var dt=new Date();var visits=Math.round((dt.getMinutes()+(60*dt.getHours()))/5);var tooltip=$(this).data('tooltip');tooltip=tooltip.replace('[visits]',visits);$(this).attr('data-tooltip',tooltip);});}
var latestReviewsInit=function(){$('.latest-reviews').each(function(){var $slider=$(this);$slider.find('.reviews-slider').slick({infinite:true,slidesToShow:1,slidesToScroll:1,autoplay:true,accessibility:false,autoplaySpeed:4000,pauseOnHover:true,arrows:true,prevArrow:'<a href="#" class="ctrl-prev"><i class="fa fa-chevron-left"></i></a>',nextArrow:'<a href="#" class="ctrl-next"><i class="fa fa-chevron-right"></i></a>',draggable:false,speed:600,rtl:Page.isRTL(),swipeToSlide:true});});}
$(document).on('click','.hosting-company-holder header a',function(e){e.preventDefault();var $this=$(this);var $ctrlsHolder=$this.closest('header');var $tabsHolder=$this.closest('.hosting-company-holder');var target=$this.data('target');if($this.hasClass('active')){if(target==='main'){window.location.href=$this.attr('href')}else{return;}}
$ctrlsHolder.find('a').removeClass('active');$this.addClass('active');$tabsHolder.find('.tab-content').removeClass('active');$tabsHolder.find('[data-tab="'+target+'"]').addClass('active');if($tabsHolder.find('.slick-slider').length>0){$tabsHolder.find('.slick-slider').slick('refresh');}});$(document).on('click','.mobile_tab_holder a',function(e){e.preventDefault();var $this=$(this);var $ctrlsHolder=$this.parent('.mobile_tab_holder');var $tabsHolder=$this.closest('.company_info');var target=$this.data('target');$ctrlsHolder.find('a').removeClass('active');$this.addClass('active');$tabsHolder.find('.mobile-tab-content').removeClass('active');$tabsHolder.find('[data-tab="'+target+'"]').addClass('active');});latestReviewsInit();countriesSearchInit();PriceFilter.init();updateVisits();setTimeout(function(){$('[data-visits-tooltip]').mouseover();},3000);setTimeout(function(){$('[data-visits-tooltip]').mouseout();},7000);$(document).on('click','.read-overview-link',function(e){e.preventDefault();$(this).parent().find('.hosting-company-overview').addClass('expanded');$(this).remove();});var mobileFilterTop=130;if($('#mobile_filter').length>0){mobileFilterTop=$('.entry-box').get(0).getBoundingClientRect().bottom;$(document).on('click','#mobile_filter',function(e){if($('.mobile_filter_plans').length===0){var filters=$('.filter_plans').html();$('#mobile_filter').append('<div class="container_div hosting-categories mobile_filter_plans text-left">'+filters+'</div>');PriceFilter.init();}else{$('.mobile_filter_plans').remove();}});$(window).bind('scroll',function(){if($(window).scrollTop()>mobileFilterTop){$('#mobile_filter').addClass('fixed');}else{$('#mobile_filter').removeClass('fixed');}});}});