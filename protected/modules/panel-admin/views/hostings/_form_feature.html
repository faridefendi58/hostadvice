<form method="post" id="feature-form" action="{{ 'hosting/companies/create-feature' | link }}/{{ hosting_company_id }}">
    <div class="alert alert-success" style="display: none;"></div>
    <div class="form-group row">
        <div class="col-md-6">
            <label class="control-label">Pilih Fitur</label>
            {% set ftrs = App.call.model("\\ExtensionsModel\\HostingFeatureModel", 'getData', {}) %}
            <select id="s2_basic" name="HostingFeature[ftitle]" class="form-control feature-list" onchange="chooseFeature(this);">
                <option value="-">Pilih</option>
                {% for fi,ftr in ftrs %}
                <option value="{{ ftr.id }}" attr-title="{{ ftr.title }}">{{ ftr.title }}</option>
                {% endfor %}
            </select>
        </div>
        <div class="col-md-6">
            <label class="control-label">Nama Fitur Baru</label>
            <input name="HostingFeature[title]" type="text" class="form-control feature-title" value="{{ pmodel.title }}">
        </div>
        <div class="clearfix mb15"></div>
    </div>
    <div class="form-group">
        <label class="control-label">Nilai <span class="red">*</span></label>
        <input name="HostingFeature[value]" type="text" class="form-control required"
               value="{{ pmodel.value }}" id="feature-value">
    </div>
    <div class="form-group">
        <label class="control-label">Catatan</label>
        <textarea name="HostingFeature[description]" class="form-control">{{ pmodel.description }}</textarea>
    </div>
    <input type="hidden" name="HostingFeature[hosting_company_id]" value="{{ hosting_company_id }}">
    <input type="hidden" name="HostingFeature[hosting_feature_id]" value="0" id="hosting_feature_id">
    <input type="hidden" name="HostingFeature[title]" value="" id="hosting_feature_title">
    <div class="form-group">
        <input type="submit" name="Submit" value="Simpan" class="btn btn-success btn-submit" onclick="return saveFeature(this);">
    </div>
</form>

{% block endbodyjs %}
<script type="text/javascript">
    function saveFeature(dt) {
        var validate = jb_validation.validate($('form[id="feature-form"]'));
        if (!validate) {
            return false;
        }
        var validate2 = validateForm();
        if (validate2 == false) {
            return false;
        }

        var url = $(dt).parent().parent().attr('action');
        console.log(url);
        $.ajax({
            'url': url,
            'type':'post',
            'data': $('#feature-form').serialize(),
            'success': function(data) {
                console.log(data);
                if (data.status == 'success') {
                    var alert_success = $('#feature-form').find('.alert-success');
                    alert_success.html(data.message);
                    alert_success.show();
                    setTimeout(function () {
                        window.location.reload(true);
                    }, 5000);
                }
            },
            'errors': function (request, status, error) {
                console.log(request.responseText);
            }
        });

        return false;
    }

    function chooseFeature(dt) {
        var opt = $(dt).find('option[value="'+ $(dt).val() +'"]');
        $('#hosting_feature_id').val($(dt).val());
        $('#hosting_feature_title').val(opt.text());
        return false;
    }
    
    function validateForm() {
        $('form[id="feature-form"]').find('.has-error').each(function () {
            $(this).removeClass('has-error');
            $(this).find('span.help-block').remove();
        });

        var has_error = 0;
        var feature_title = $('.feature-title').val();
        if (feature_title.length <= 0) {
            var feature_list = $('.feature-list option').filter(':selected').val();
            if (feature_list.length == 0 || feature_list == '-') {
                var msg = "<span class=\"help-block\">Mohon pilih fitur atau buat nama fitur baru.</span>";
                $('.feature-list').parent().addClass('has-error').append(msg);
                has_error = has_error + 1;
            } else {
                $('.feature-list').parent().removeClass('has-error');
                $('.feature-list').parent().find('span.help-block').remove();
            }
        }

        return (has_error == 0)? true : false;
    }
</script>
{% endblock %}